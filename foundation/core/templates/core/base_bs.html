{% load i18n staticfiles auth_tokens %}
<!DOCTYPE html>
<html lang="{{ lang }}">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        {% block meta %}{% endblock %}
		{% block page_title %}{% endblock %}
		{% block head_style %}
            <link rel="stylesheet" href="{% static 'ikwen/css/bootstrap.min.css' %}" />
            <link rel='stylesheet' href="{% static 'ikwen/font-awesome/css/font-awesome.min.css' %}" />
            <link rel='stylesheet' href="{% static 'ikwen/css/flatly.bootstrap.min.css' %}" />
            <link rel='stylesheet' href="{% static 'ikwen/css/base.css' %}" />
		{% endblock %}
        {% block head_js %}
            <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
            <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
            <!--[if lt IE 9]>
              <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
              <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
            <![endif]-->
        {% endblock %}
    </head>
    <body>
        <div id="top-notice-ctnr" style="display: none">
            <span class="floating-notice has-shade" style="float: none; position: static"> Error goes here </span>
        </div>
        {% block header %}
            <nav id="navbar" class="navbar navbar-default navbar-static-top">
                <div class="container-fluid">
                    {% block header_brand %}
                    <div class="navbar-header">
                        <a class="navbar-brand" href="{{ settings.PROJECT_URL|append_auth_tokens:request }}">{{ service.project_name }}</a>
                    </div>
                    {% endblock %}
                    <form class="search" action="">
                        <input type="text" class="form-control input-sm inner-shade" placeholder="{% trans "Search" %}"/>
                        <div class="results has-shade" style="display: none" data-min-search-chars="2">
                            {% include 'core/snippets/spinner.html' %}
                            <ul>
                                <li class="member tpl" style="display: none">
                                    <a class="target_url" style="display: block">
                                        <span class="photo logo bg-img" style="background-image: url({% static 'ikwen/img/no_photo.png' %})"></span>
                                        <div style="float: left; margin-left: 30px">
                                            <span class="full_name project_name"></span>
                                            <p class="about short_description"></p>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </form>
                    <ul class="nav navbar-nav navbar-right">
                        {% if user.is_authenticated %}
                            <li>
                                <a href="{{ settings.IKWEN_CONSOLE_URL|append_auth_tokens:request }}">
                                    {% trans "Home" %}
                                    {% if user.get_notice_count > 0 %}<span class="label label-danger">{{ user.get_notice_count }}</span>{% endif %}
                                </a>
                            </li>
                            {% if user.collaborates_on|length == 1 %}
                                <li>
                                    <a href="{{ user.collaborates_on.0.admin_url|append_auth_tokens:request }}">{{ user.collaborates_on.0.project_name }}</a>
                                </li>
                            {% elif user.collaborates_on|length > 1 %}
                                <li id="apps" class="dropdown">
                                    <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Apps</a>
                                    <ul class="dropdown-menu" aria-labelledby="apps">
                                        {% for app in user.collaborates_on %}
                                            <li><a href="{{ app.admin_url|append_auth_tokens:request }}">{{ app.project_name }}</a> </li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            {% endif %}
                            <li id="user-menu" class="dropdown">
                                <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <img src="{% static 'ikwen/img/user-icon.png' %}" />
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="user-menu">
                                    <li style="padding: 3px 20px"> {{ user.get_short_name }} </li>
                                    <li role="separator" class="divider"></li>
                                    <li>{% url "ikwen:account_setup" as account_setup_url%}
                                        <a href="{{ account_setup_url|ikwenize|append_auth_tokens:request }}">{% trans "Account setup" %}</a>
                                    </li>
                                    <li><a href="{% url "ikwen:logout" %}">{% trans "Logout" %}</a> </li>
                                </ul>
                            </li>
                        {% else %}
                            <li>
                                {% url 'ikwen:sign_in' as sign_in_url %}
                                <a href="{{ sign_in_url|append_auth_tokens:request }}">Login</a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </nav>
        {% endblock %}
        {% block selection_control %}{% endblock %}
        {% block content %}{% endblock %}
        {% block footer %}
            <footer style="color: #999; font-size: 12px; margin-top: 45px; text-align: center">
                &copy; {{ year }} <a href="{{ service.url|append_auth_tokens:request }}" style="color: #666; text-decoration: none"><strong>{{ config.company_name }}</strong></a>.
                {% trans "All rights reserved." %}
                {% if config.legal_mentions_url %}
                - <a href="{{ config.legal_mentions_url }}" style="color: #666; text-decoration: none">{% trans "Legal mentions" %}</a>
                {% endif %}
            </footer>
        {% endblock %}
        <script src="{% static 'ikwen/js/jquery-1.12.4.min.js' %}"></script>
        <script src="{% static 'ikwen/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'ikwen/js/ikwen-util.js' %}"></script>
        {% block js %}
            <script>
                (function() {
                    ikwen.URL_KEY = '{{ request.GET.key }}';
                    ikwen.URL_RAND = '{{ request.GET.rand }}';
                    $('form#lang a').click(function() {
                        var lang = $(this).data('val');
                        $('form#lang input[name=language]').val(lang);
                        $('form#lang').submit();
                        return false
                    });
                    {% url 'ikwen:list_projects' as list_projects_url %}
                    var searchDescriptor = [{
                        endpoint: '{{ list_projects_url|ikwenize }}',
                        resultTplSelector: '#navbar .search .results li.member',
                        jsonp: true
                    }];
                    $('nav#navbar .search input').focusout(function() {$('nav#navbar .search .results').fadeOut()});
                    ikwen.setupSearch('#navbar .search input', '#navbar .search .results', searchDescriptor);
                })()
            </script>
        {% endblock %}
    </body>
</html>